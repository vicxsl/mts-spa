<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.qisen.mts.spa.dao.GoodsDao">

	<!-- 通过手机号码检测账号是否存在 -->
	<select id="check" resultType="int"
		parameterType="com.qisen.mts.spa.model.entity.SpaGoods">
		<![CDATA[
			select count(id)  from  goods 
		]]>
		<where>
			<if test="no != null and no !=''">
				<![CDATA[
					 no = #{no} 
				]]>
			</if>
			<if test="name != null and name !=''">
				<![CDATA[
					and name = #{name} 
				]]>
			</if>
			<if test="barCode != null and barCode !=''">
				<![CDATA[
					and barCode = #{barCode} 
				]]>
			</if>
			<if test="id != null and id >0">
				<![CDATA[
					and id != #{id} 
				]]>
			</if>
		</where>
	</select>
	<select id="getGoodsByPara" parameterType="com.qisen.mts.spa.model.entity.SpaGoods"
		resultType="com.qisen.mts.spa.model.entity.SpaGoods">
		select t.id,t.num,t.appid,t.eid
		from goods t where
		t.id=#{id} and t.eid=#{eid} and t.appid = #{appid}
	</select>

	<!--新增商品 -->
	<insert id="create" parameterType="com.qisen.mts.spa.model.entity.SpaGoods">
		<![CDATA[
			insert into goods(eid,appid,name,no,barCode,type,unit,spec,num,saleNum,buyingPrice,costPrice,salePrice,preferencePrice,status,describeText,remark) 
			values(#{eid},#{appid},#{name},#{no},#{barCode},#{type},#{unit},#{spec},#{num},#{saleNum},#{buyingPrice},#{costPrice},#{salePrice},#{preferencePrice},0,#{describeText},#{remark})
		]]>
	</insert>

	<!-- 删除商品 -->
	<update id="delete" parameterType="list">
		<![CDATA[
            update goods
        ]]>
		<set>
				<![CDATA[
					 status = "-1"
				 ]]>
		</set>
		<where>
			<foreach collection="list" separator="or" item="i" index="index">
			 	<![CDATA[
              		id=#{i.id} and eid = #{i.eid} and appid = #{i.appid}  
              	]]>
			</foreach>
		</where>
	</update>

	<update id="update" parameterType="com.qisen.mts.spa.model.entity.SpaGoods">
		<![CDATA[
			update goods
		]]>
		<set>
			<if test="name != null and name !=''">
				<![CDATA[
					 name = #{name},
				 ]]>
			</if>
			<if test="no != null and no !=''">
				<![CDATA[
					 no = #{no},
				 ]]>
			</if>
			<if test="status != null and status !=''">
				<![CDATA[
					 status = #{status},
				 ]]>
			</if>
			<if test="remark != null and remark !=''">
				<![CDATA[
					 remark = #{remark},
				 ]]>
			</if>
			<if test="describeText != null and describeText !=''">
				<![CDATA[
					 describeText = #{describeText},
				 ]]>
			</if>
			<if test="barCode != null and barCode !=''">
				<![CDATA[
					 barCode = #{barCode},
				 ]]>
			</if>
			<if test="type != null and type !=''">
				<![CDATA[
					 type = #{type},
				 ]]>
			</if>
			<if test="unit != null and unit !=''">
				<![CDATA[
					 unit = #{unit},
				 ]]>
			</if>
			<if test="spec != null and spec !=''">
				<![CDATA[
					 spec = #{spec},
				 ]]>
			</if>
			<if test="salePrice != null and salePrice !=''">
				<![CDATA[
					 salePrice = #{salePrice},
				 ]]>
			</if>
			<if test="preferencePrice != null and preferencePrice !=''">
				<![CDATA[
					 preferencePrice = #{preferencePrice},
				 ]]>
			</if>
		</set>
		<where>
			<![CDATA[
				 eid = #{eid} and appid = #{appid} and id = #{id}
			]]>
		</where>
	</update>



	<!-- 查询SPA商品列表 -->
	<select id="list" resultType="com.qisen.mts.spa.model.entity.SpaGoods"
		parameterType="com.qisen.mts.spa.model.entity.SpaGoods">
		<![CDATA[
			select * from goods
		]]>
		<where>
			<![CDATA[
				appid = #{appid}
			]]>
			<if test="eid != null and eid !=''">
				<![CDATA[
					and eid = #{eid} 
				]]>
			</if>
			<if test="no != null and no !=''">
				<![CDATA[
					and no = #{no} 
				]]>
			</if>
			<if test="name != null and name !=''">
				<![CDATA[
					and name = #{name} 
				]]>
			</if>
			<if test="status != null and status !=''">
				<![CDATA[
					and status = #{status} 
				]]>
			</if>
			<choose>
				<when test="status !=null and status != ''">
					<![CDATA[
						and status = #{status}
					]]>
				</when>
				<otherwise>
					<![CDATA[
						and status != "-1"
					]]>
				</otherwise>
			</choose>
		</where>
		<![CDATA[
			order by no+0
		]]>
	</select>

	<!-- 查询SPA商品图文详情 -->
	<select id="goodsImgList" resultType="com.qisen.mts.spa.model.entity.SpaImg"
		parameterType="com.qisen.mts.spa.model.entity.SpaImg">
		<![CDATA[
			select * from imgTable
		]]>
		<where>
			<![CDATA[
				appid = #{appid} and eid = #{eid} and type in ("1","2") and goodsId=#{goodsId}
			]]>

			<if test="status != null and status !=''">
				<![CDATA[
					and status = #{status} 
				]]>
			</if>
		</where>
	</select>
	
	<!-- 查询单个SPA商品 -->
	<select id="details" resultType="com.qisen.mts.spa.model.entity.SpaGoods"
		parameterType="com.qisen.mts.spa.model.entity.SpaGoods">
		<![CDATA[
			select * from goods where id=#{id}
		]]>
	</select>

</mapper>
