<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.qisen.mts.spa.dao.GoodsShopCarDao">
	
	<!--新增商品到购物车 -->
	<insert id="add" parameterType="com.qisen.mts.spa.model.entity.SpaGoodsShopCar">
		<![CDATA[
			insert into goodsShopCar(eid,sid,goodsId,memberId,num,createDate,updateTime,status) 
			values(#{eid},#{sid},#{goodsId},#{memberId},#{num},#{createDate},#{updateTime},0)
		]]>
	</insert>

	<!--新增商品到购物车 -->
	<select id="check" parameterType="com.qisen.mts.spa.model.entity.SpaGoodsShopCar"  resultType="int">
		<![CDATA[
			select count(id) from goodsShopCar
		]]>
		<where>
			<![CDATA[
				eid = #{eid} and sid = #{sid} and status = 0 and goodsId = #{goodsId}
			]]>
			<if test="memberId != null and memberId !=''">
				<![CDATA[
					and memberId = #{memberId} 
				]]>
			</if>
		</where>
	</select>
	
	<!-- 删除  还可添加会员id限制-->
	<delete id="delete" parameterType="com.qisen.mts.spa.model.entity.SpaGoodsShopCar">
		<![CDATA[
			delete from goodsShopCar
		]]>
		<where>
			<![CDATA[
				eid = #{eid} and sid = #{sid} and id=#{id} 
			]]>
		</where>
	</delete>

	<update id="update" parameterType="com.qisen.mts.spa.model.entity.SpaGoodsShopCar">
		<![CDATA[
			update goodsShopCar
		]]>
		<set>
			<if test="num != null and num > 0">
				<![CDATA[
					 num = (#{num}+num)
				 ]]>
			</if>
		</set>
		<where>
			<![CDATA[
				 eid = #{eid} and sid = #{sid} and goodsId = #{goodsId}
			]]>
			<if test="id != null and id > 0">
				<![CDATA[
					 and id = #{id}
				 ]]>
			</if>
			<if test="memberId != null and memberId !=''">
				<![CDATA[
					and memberId = #{memberId} 
				]]>
			</if>
		</where>
	</update>



	<!-- 查询列表 -->
	<select id="list" resultType="com.qisen.mts.spa.model.entity.SpaGoodsShopCar"
		parameterType="com.qisen.mts.spa.model.entity.SpaGoodsShopCar">
		<![CDATA[
			select a.*,b.name,b.unit,b.salePrice,b.preferencePrice,b.spec from goodsShopCar a,goods b
		]]>
		<where>
			<![CDATA[
				a.eid = #{eid} and a.sid = #{sid} and a.eid = b.eid and a.sid = b.sid and a.goodsId = b.id
			]]>
			<if test="memberId != null and memberId !=''">
				<![CDATA[
					and memberId = #{memberId} 
				]]>
			</if>
		</where>
	</select>

</mapper>
